!function(e){var t=function(e,t){this.defaultKS3Options={KSSAccessKeyId:"",policy:"",signature:"",bucket_name:"",key:"",acl:"private",uploadDomain:"",autoStart:!1,onInitCallBack:function(){},onErrorCallBack:function(){},onFilesAddedCallBack:function(){},onBeforeUploadCallBack:function(){},onStartUploadFileCallBack:function(){},onUploadProgressCallBack:function(){},onFileUploadedCallBack:function(){},onUploadCompleteCallBack:function(){}},e&&plupload.extend(this.defaultKS3Options,e);var s={};for(var a in s=this.defaultKS3Options.signature&&this.defaultKS3Options.policy?{key:this.defaultKS3Options.key,acl:this.defaultKS3Options.acl,signature:this.defaultKS3Options.signature,KSSAccessKeyId:this.defaultKS3Options.KSSAccessKeyId,policy:this.defaultKS3Options.policy,"Cache-Control":this.defaultKS3Options["Cache-Control"],Expires:this.defaultKS3Options.Expires,"Content-Disposition":this.defaultKS3Options["Content-Disposition"],"Content-Encoding":this.defaultKS3Options["Content-Encoding"],"Content-Type":this.defaultKS3Options["Content-Type"],"Content-Encoding":this.defaultKS3Options["Content-Encoding"]}:{key:this.defaultKS3Options.key,acl:this.defaultKS3Options.acl,KSSAccessKeyId:this.defaultKS3Options.KSSAccessKeyId},this.defaultKS3Options)("string"==typeof this.defaultKS3Options[a]&&-1!==a.indexOf("x-kss-meta-")||"x-kss-newfilename-in-body"==a)&&(s[a]=this.defaultKS3Options[a]);this.defaultPluploadOptions={runtimes:"html5,flash,silverlight,html4",url:this.defaultKS3Options.uploadDomain,browse_button:"browse",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",drop_element:void 0,multipart:!0,multipart_params:s},t&&plupload.extend(this.defaultPluploadOptions,t),this.uploader=new plupload.Uploader(this.defaultPluploadOptions),this.uploader.bind("Init",this.onInit,this),this.uploader.bind("Error",this.onUploadError,this),this.uploader.init(),this.uploader.bind("FilesAdded",this.onFilesAdded,this),this.uploader.bind("BeforeUpload",this.onBeforeUpload,this),this.uploader.bind("UploadFile",this.onStartUploadFile,this),this.uploader.bind("UploadProgress",this.onUploadProgress,this),this.uploader.bind("FileUploaded",this.onFileUploaded,this),this.uploader.bind("UploadComplete",this.onUploadComplete,this)};t.prototype.onInit=function(e,t){this.defaultKS3Options.onInitCallBack&&this.defaultKS3Options.onInitCallBack.apply(this,[e,t])},t.prototype.onUploadError=function(e,t){this.defaultKS3Options.onErrorCallBack&&this.defaultKS3Options.onErrorCallBack.apply(this,[e,t])},t.prototype.onFilesAdded=function(e,t){this.defaultKS3Options.autoStart&&this.uploader.start(),this.defaultKS3Options.onFilesAddedCallBack&&this.defaultKS3Options.onFilesAddedCallBack.apply(this,[e,t])},t.prototype.onBeforeUpload=function(e,t){this.defaultKS3Options.onBeforeUploadCallBack&&this.defaultKS3Options.onBeforeUploadCallBack.apply(this,[e,t])},t.prototype.onStartUploadFile=function(e,t){this.defaultKS3Options.onStartUploadFileCallBack&&this.defaultKS3Options.onStartUploadFileCallBack.apply(this,[e,t])},t.prototype.onUploadProgress=function(e,t){this.defaultKS3Options.onUploadProgressCallBack&&this.defaultKS3Options.onUploadProgressCallBack.apply(this,[e,t])},t.prototype.onFileUploaded=function(e,t,s){this.defaultKS3Options.onFileUploadedCallBack&&this.defaultKS3Options.onFileUploadedCallBack.apply(this,[e,t,s])},t.prototype.onUploadComplete=function(e,t){this.defaultKS3Options.onUploadCompleteCallBack&&this.defaultKS3Options.onUploadCompleteCallBack.apply(this,[e,t])},e.ks3FileUploader=t}(window);var Ks3={};function getExpires(e){return Math.round((new Date).getTime()/1e3)+e}Ks3.addURLParam=function(e,t){e+=-1==e.indexOf("?")?"?":"";var s=[];for(var a in t){var n=t[a=encodeURIComponent(a)];n&&"[object String]"==Object.prototype.toString.call(n)&&s.push(a+"="+encodeURIComponent(n))}return e+s.join("&")},Ks3.xmlToJson=function(e){var t={};if(e.nodeType==Node.TEXT_NODE&&(t=e.nodeValue),e.hasChildNodes())for(var s=0;s<e.childNodes.length;s++){var a=e.childNodes.item(s),n=a.nodeName;if(void 0===t[n])"#text"===n?t=a.nodeValue:t[n]=Ks3.xmlToJson(a);else{if(void 0===t[n].length){var o=t[n];t[n]=[],t[n].push(o)}t[n].push(Ks3.xmlToJson(a))}}return t},Ks3.Base64={encTable:["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],decTable:[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1],encUTF8:function(e){for(var t,s,a,n,o,r,i,l=[],u=e.length,c=0;c<u;c++)(t=e.charCodeAt(c))>0&&t<=127?l.push(t):t>=128&&t<=2047?(s=192|t>>6&31,a=128|63&t,l.push(s,a)):t>=2048&&t<=65535?(s=224|t>>12&15,a=128|t>>6&63,n=128|63&t,l.push(s,a,n)):t>=65536&&t<=2097151?(s=240|t>>18&7,a=128|t>>12&63,n=128|t>>6&63,o=128|63&t,l.push(s,a,n,o)):t>=2097152&&t<=67108863?(s=240|t>>24&3,a=240|t>>18&63,n=128|t>>12&63,o=128|t>>6&63,r=128|63&t,l.push(s,a,n,o,r)):t>=67108864&&t<=2147483647&&(s=240|t>>30&1,a=240|t>>24&63,n=240|t>>18&63,o=128|t>>12&63,r=128|t>>6&63,i=128|63&t,l.push(s,a,n,o,r,i));return l},encode:function(e){if(!e)return"";for(var t,s,a,n=this.encUTF8(e),o=0,r=n.length,i=[];o<r;){if(t=255&n[o++],i.push(this.encTable[t>>2]),o==r){i.push(this.encTable[(3&t)<<4],"==");break}if(s=n[o++],o==r){i.push(this.encTable[(3&t)<<4|s>>4&15]),i.push(this.encTable[(15&s)<<2],"=");break}a=n[o++],i.push(this.encTable[(3&t)<<4|s>>4&15]),i.push(this.encTable[(15&s)<<2|(192&a)>>6]),i.push(this.encTable[63&a])}return i.join("")}},Ks3.chrsz=8,Ks3.b64pad="=",Ks3.b64_hmac_sha1=function(e,t){return Ks3.binb2b64(Ks3.core_hmac_sha1(e,t))},Ks3.core_hmac_sha1=function(e,t){var s=Ks3.str2binb(e);s.length>16&&(s=Ks3.core_sha1(s,e.length*Ks3.chrsz));for(var a=Array(16),n=Array(16),o=0;o<16;o++)a[o]=909522486^s[o],n[o]=1549556828^s[o];var r=Ks3.core_sha1(a.concat(Ks3.str2binb(t)),512+t.length*Ks3.chrsz);return Ks3.core_sha1(n.concat(r),672)},Ks3.binb2b64=function(e){for(var t="",s=0;s<4*e.length;s+=3)for(var a=(e[s>>2]>>8*(3-s%4)&255)<<16|(e[s+1>>2]>>8*(3-(s+1)%4)&255)<<8|e[s+2>>2]>>8*(3-(s+2)%4)&255,n=0;n<4;n++)8*s+6*n>32*e.length?t+=Ks3.b64pad:t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(a>>6*(3-n)&63);return t},Ks3.str2binb=function(e){for(var t=Array(),s=(1<<Ks3.chrsz)-1,a=0;a<e.length*Ks3.chrsz;a+=Ks3.chrsz)t[a>>5]|=(e.charCodeAt(a/Ks3.chrsz)&s)<<32-Ks3.chrsz-a%32;return t},Ks3.core_sha1=function(e,t){e[t>>5]|=128<<24-t%32,e[15+(t+64>>9<<4)]=t;for(var s=Array(80),a=1732584193,n=-271733879,o=-1732584194,r=271733878,i=-1009589776,l=0;l<e.length;l+=16){for(var u=a,c=n,d=o,p=r,K=i,f=0;f<80;f++){s[f]=f<16?e[l+f]:Ks3.rol(s[f-3]^s[f-8]^s[f-14]^s[f-16],1);var g=Ks3.safe_add(Ks3.safe_add(Ks3.rol(a,5),Ks3.sha1_ft(f,n,o,r)),Ks3.safe_add(Ks3.safe_add(i,s[f]),Ks3.sha1_kt(f)));i=r,r=o,o=Ks3.rol(n,30),n=a,a=g}a=Ks3.safe_add(a,u),n=Ks3.safe_add(n,c),o=Ks3.safe_add(o,d),r=Ks3.safe_add(r,p),i=Ks3.safe_add(i,K)}return Array(a,n,o,r,i)},Ks3.safe_add=function(e,t){var s=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(s>>16)<<16|65535&s},Ks3.rol=function(e,t){return e<<t|e>>>32-t},Ks3.sha1_ft=function(e,t,s,a){return e<20?t&s|~t&a:e<40?t^s^a:e<60?t&s|t&a|s&a:t^s^a},Ks3.sha1_kt=function(e){return e<20?1518500249:e<40?1859775393:e<60?-1894007588:-899497514},Ks3.generateHeaders=function(e){var t="",s=[];if(e){for(var a in e)0==a.indexOf("x-kss")&&s.push(a.toLowerCase()+":"+e[a]);s.sort(),t=s.join("\n")}return t},Ks3.generateToken=function(e,t,s,a,n,o,r){var i=Ks3.generateHeaders(o),l="/"+t+"/"+s;if(""!==i)var u=a+"\n\n"+n+"\n"+r+"\n"+i+"\n"+l;else u=a+"\n\n"+n+"\n"+r+"\n"+l;return Ks3.b64_hmac_sha1(e,u)},Ks3.ENDPOINT={AMERICA:"ks3-us-west-1.ksyuncs.com",BEIJING:"ks3-cn-beijing.ksyuncs.com",HONGKONG:"ks3-cn-hk-1.ksyuncs.com",SHANGHAI:"ks3-cn-shanghai.ksyuncs.com",GUANGZHOU:"ks3-cn-guangzhou.ksyuncs.com",RUSSIA:"ks3-rus.ksyuncs.com",SINGAPORE:"ks3-sgp.ksyuncs.com",JR_BEIJING:"ks3-jr-beijing.ksyuncs.com",JR_SHANGHAI:"ks3-jr-shanghai.ksyuncs.com",GOV_BEIJING:"ks3-gov-beijing.ksyuncs.com"},Ks3.config={AK:"",SK:"",protocol:"http",baseUrl:"",region:"",bucket:"",prefix:"kss",chunkSize:5242880,retries:20,currentUploadId:"",stopFlag:!1},Ks3.listObject=function(e,t){var s=new XMLHttpRequest,a={delimiter:e.delimiter,"encoding-type":e["encoding-type"],marker:e.marker,"max-keys":e["max-keys"],prefix:e.prefix},n=e.Bucket||Ks3.config.bucket,o=e.region||Ks3.config.region;o&&(Ks3.config.baseUrl=Ks3.ENDPOINT[o]);var r=Ks3.config.protocol+"://"+n+"."+Ks3.config.baseUrl;r=Ks3.addURLParam(r,a),s.overrideMimeType("text/xml"),s.onreadystatechange=function(){4==s.readyState&&(s.status>=200&&s.status<300||304==s.status?t(Ks3.xmlToJson(s.responseXML)):(alert("Request was unsuccessful: "+s.status),console.log("status: "+s.status)))},s.open("GET",r,!0);var i=(new Date).toGMTString()+"",l={"x-kss-date":i};s.setRequestHeader("x-kss-date",i);var u=e.Signature||Ks3.generateToken(Ks3.config.SK,n,"","GET","",l,i);s.setRequestHeader("Authorization","KSS "+Ks3.config.AK+":"+u),s.send(null)},Ks3.delObject=function(e,t){var s=e.Bucket||Ks3.config.bucket,a=Ks3.encodeKey(e.Key),n=e.region||Ks3.config.region;n&&(Ks3.config.baseUrl=Ks3.ENDPOINT[n]);var o=new XMLHttpRequest,r=Ks3.config.protocol+"://"+s+"."+Ks3.config.baseUrl+"/"+a,i=(new Date).toGMTString()+"",l={"x-kss-date":i},u=e.Signature||Ks3.generateToken(Ks3.config.SK,s,a,"DELETE","",l,i);o.onreadystatechange=function(){4==o.readyState&&(o.status>=200&&o.status<300||304==o.status?t(o.status):(alert("Request was unsuccessful: "+o.status),console.log("status: "+o.status)))},o.open("DELETE",r,!0),o.setRequestHeader("x-kss-date",i),o.setRequestHeader("Authorization","KSS "+Ks3.config.AK+":"+u),o.send(null)},Ks3.encodeKey=function(e){if(null==e)return"";var t=encodeURIComponent(e);return t=t.replace(/\+/g,"%20").replace(/\*/g,"%2A").replace(/%7E/g,"~").replace(/%2F/g,"/")},Ks3.headObject=function(e,t){null!==e.Key&&void 0!==e.Key||alert("require the Key");var s=Ks3.encodeKey(e.Key),a=e.region||Ks3.config.region;a&&(Ks3.config.baseUrl=Ks3.ENDPOINT[a]);var n=e.Bucket||Ks3.config.bucket||"";n||alert("require the bucket name");var o=Ks3.config.protocol+"://"+n+"."+Ks3.config.baseUrl+"/"+s,r="HEAD",i=(new Date).toGMTString()+"",l={"x-kss-date":i},u=e.Signature||Ks3.generateToken(Ks3.config.SK,n,s,r,"",l,i),c=new XMLHttpRequest;c.onreadystatechange=function(){4==c.readyState&&(c.status>=200&&c.status<300||304==c.status?t(null,c):(console.log("status: "+c.status),t({msg:"request failed"},c)))},c.open(r,o,!0),c.setRequestHeader("x-kss-date",i),c.setRequestHeader("Authorization","KSS "+Ks3.config.AK+":"+u),c.send(null)},Ks3.getObject=function(e,t){null!==e.Key&&void 0!==e.Key||alert("require the Key");var s=Ks3.encodeKey(e.Key),a=e.region||Ks3.config.region;a&&(Ks3.config.baseUrl=Ks3.ENDPOINT[a]);var n=e.Bucket||Ks3.config.bucket||"";n||alert("require the bucket name");var o=e.range||"",r=Ks3.config.protocol+"://"+Ks3.config.baseUrl+"/"+n+"/"+s,i=new XMLHttpRequest,l=(new Date).toGMTString()+"",u={"x-kss-date":l},c=e.Signature||Ks3.generateToken(Ks3.config.SK,n,s,"GET","",u,l);i.onreadystatechange=function(){if(4==i.readyState)if(i.status>=200&&i.status<300||304==i.status){var e=new Blob([this.response],{type:this.getResponseHeader("Content-Type")});t(null,e,i)}else console.log("status: "+i.status),t({msg:"request failed"},e,i)},i.open("GET",r,!0),i.responseType="arraybuffer";""!==o&&/^bytes=(\d+)-(\d+)$/i.test(o)&&i.setRequestHeader("Range",o),i.setRequestHeader("x-kss-date",l),i.setRequestHeader("Authorization","KSS "+Ks3.config.AK+":"+c),i.send(null)},Ks3.putObject=function(e,t){null!==e.Key&&void 0!==e.Key||alert("require the Key");var s=Ks3.encodeKey(e.Key),a=e.region||Ks3.config.region;a&&(Ks3.config.baseUrl=Ks3.ENDPOINT[a]);var n=e.Bucket||Ks3.config.bucket||"";n||alert("require the bucket name");var o=Ks3.config.protocol+"://"+n+"."+Ks3.config.baseUrl+"/"+s,r=new XMLHttpRequest;r.open("PUT",o,!0);var i={},l=e.ACL;if("private"==l||"public-read"==l){var u="x-"+Ks3.config.prefix+"-acl";r.setRequestHeader(u,l),i[u]=l}var c=(new Date).toGMTString()+"";i["x-kss-date"]=c,r.setRequestHeader("x-kss-date",c);var d=e.callbackurl||"",p=e.callbackbody||"";if(d){var K="x-"+Ks3.config.prefix+"-callbackurl";r.setRequestHeader(K,d),i[K]=d}if(p){var f="x-"+Ks3.config.prefix+"-callbackbody";r.setRequestHeader(f,p),i[f]=p}var g=e.Signature||Ks3.generateToken(Ks3.config.SK,n,s,"PUT",e.File.type,i,c);r.onreadystatechange=function(){if(4==r.readyState)if(r.status>=200&&r.status<300||304==r.status)t(null);else if(413===r.status||415===r.status){var e=Ks3.xmlToJson(r.responseXML).Error.Message;t({msg:e})}else console.log("status: "+r.status),t({msg:"request failed"})},r.upload.addEventListener("progress",e.ProgressListener,!1),r.setRequestHeader("Authorization","KSS "+Ks3.config.AK+":"+g),r.send(e.File)},Ks3.multitpart_upload_init=function(e,t){var s=e.Bucket||Ks3.config.bucket||"",a=Ks3.encodeKey(e.Key)||null;if(!s)throw new Error("require the bucketName");if(!a)throw new Error("require the object Key");var n=e.region||Ks3.config.region;n&&(Ks3.config.baseUrl=Ks3.ENDPOINT[n]);var o=a+"?uploads";o=o.replace(/\/\//g,"/%2F");var r=e.ContentType||"",i="POST",l=Ks3.config.protocol+"://"+s+"."+Ks3.config.baseUrl+"/"+o,u=new XMLHttpRequest;u.open(i,l,!0);var c={},d=e.ACL;if("private"==d||"public-read"==d){var p="x-"+Ks3.config.prefix+"-acl";u.setRequestHeader(p,d),c[p]=d}var K=e.TotalSize;if(K){var f="x-"+Ks3.config.prefix+"-meta-content-length";u.setRequestHeader(f,K),c[f]=K}var g=(new Date).toGMTString()+"";c["x-kss-date"]=g,u.setRequestHeader("x-kss-date",g);var h=e.Signature||Ks3.generateToken(Ks3.config.SK,s,o,i,r,c,g);u.overrideMimeType("text/xml"),u.onreadystatechange=function(){if(4==u.readyState)if(u.status>=200&&u.status<300||304==u.status){var e=Ks3.xmlToJson(u.responseXML).InitiateMultipartUploadResult.UploadId;t(null,e)}else 413===u.status||415===u.status?t({status:u.status,msg:Ks3.xmlToJson(u.responseXML).Error.Message},null):(console.log("status: "+u.status),t({msg:"request failed"},null))},u.setRequestHeader("Authorization","KSS "+Ks3.config.AK+":"+h),r&&u.setRequestHeader("Content-Type",r),u.send(null)},Ks3.upload_part=function(e,t){var s=e.Bucket||Ks3.config.bucket||"",a=Ks3.encodeKey(e.Key)||null,n=e.ContentType||"",o=void 0!==e.PartNumber?e.PartNumber:"",r=e.UploadId||"";if(!s||!a)throw new Error("require the bucketName and object key");if(""===o||!r)throw new Error("require the partNumber and uploadId");var i=e.body||"",l=a+"?partNumber="+o+"&uploadId="+r;l=l.replace(/\/\//g,"/%2F");var u=Ks3.config.protocol+"://"+s+"."+Ks3.config.baseUrl+"/"+l,c=(new Date).toGMTString()+"",d={"x-kss-date":c},p=e.Signature||Ks3.generateToken(Ks3.config.SK,s,l,"PUT",n,d,c),K=new XMLHttpRequest;K.onreadystatechange=function(){if(4==K.readyState)if(K.status>=200&&K.status<300||304==K.status){var e=K.getResponseHeader("Etag");t(null,o,e)}else 413===K.status||415===K.status?t({status:K.status,msg:Ks3.xmlToJson(K.responseXML).Error.Message},null):(console.log("status: "+K.status),t({msg:"request failed"},null))},K.open("PUT",u,!0),K.setRequestHeader("x-kss-date",c),K.setRequestHeader("Authorization","KSS "+Ks3.config.AK+":"+p),n&&K.setRequestHeader("Content-Type",n),i&&K.send(i)},Ks3.upload_complete=function(e,t){var s=e.Bucket||Ks3.config.bucket||"",a=Ks3.encodeKey(e.Key)||null,n=e.UploadId||"",o=e.callbackurl||"",r=e.callbackbody||"";if(!s||!a)throw new Error("require the bucketName and object key");if(!n)throw new Error("require the uploadId");var i=e.body||"",l=a+"?uploadId="+n;l=l.replace(/\/\//g,"/%2F");var u={};o&&(u["x-"+Ks3.config.prefix+"-callbackurl"]=o);r&&(u["x-"+Ks3.config.prefix+"-callbackbody"]=r);var c=Ks3.config.protocol+"://"+s+"."+Ks3.config.baseUrl+"/"+l,d="POST",p=(new Date).toGMTString()+"";u["x-kss-date"]=p,signature=e.Signature||Ks3.generateToken(Ks3.config.SK,s,l,d,"text/plain;charset=UTF-8",u,p);var K=new XMLHttpRequest;K.overrideMimeType("text/xml"),K.onreadystatechange=function(){if(4==K.readyState)if(K.status>=200&&K.status<300||304==K.status){var e=Ks3.xmlToJson(K.responseXML);t(null,e)}else console.log("status: "+K.status),t({msg:"request failed",status:K.status},e)},K.open(d,c,!0),K.setRequestHeader("x-kss-date",p),K.setRequestHeader("Authorization","KSS "+Ks3.config.AK+":"+signature),o&&K.setRequestHeader("x-kss-callbackurl",o),r&&K.setRequestHeader("x-kss-callbackbody",r),i&&K.send(i)},Ks3.abort_multipart_upload=function(e,t){var s=e.Bucket||Ks3.config.bucket||"",a=Ks3.encodeKey(e.Key)||null,n=e.UploadId||"";if(!s||!a)throw new Error("require the bucketName and object key");if(!n)throw new Error("require the uploadId");var o=a+"?uploadId="+n;o=o.replace(/\/\//g,"/%2F");var r=Ks3.config.protocol+"://"+s+"."+Ks3.config.baseUrl+"/"+o,i="DELETE",l=(new Date).toGMTString()+"",u={"x-kss-date":l},c=e.Signature||Ks3.generateToken(Ks3.config.SK,s,o,i,"",u,l),d=new XMLHttpRequest;d.onreadystatechange=function(){4==d.readyState&&(204==d.status?t(null,{status:d.status}):(console.log("status: "+d.status),t({msg:"request failed",status:d.status})))},d.open(i,r,!0),d.setRequestHeader("x-kss-date",l),d.setRequestHeader("Authorization","KSS "+Ks3.config.AK+":"+c),d.send(null)},Ks3.upload_list_part=function(e,t){var s=e.Bucket||Ks3.config.bucket||"",a=Ks3.encodeKey(e.Key)||null,n=e.UploadId||"";if(!s||!a)throw new Error("require the bucketName and object key");if(!n)throw new Error("require the uploadId");var o=a+"?uploadId="+n;o=o.replace(/\/\//g,"/%2F");var r=Ks3.config.protocol+"://"+s+"."+Ks3.config.baseUrl+"/"+o,i=(new Date).toGMTString()+"",l={"x-kss-date":i},u=e.Signature||Ks3.generateToken(Ks3.config.SK,s,o,"GET","",l,i),c=new XMLHttpRequest;c.overrideMimeType("text/xml"),c.onreadystatechange=function(){if(4==c.readyState)if(c.status>=200&&c.status<300||304==c.status){var e=Ks3.xmlToJson(c.responseXML);t(null,e)}else console.log("status: "+c.status),t({msg:"request failed",status:c.status},e)},c.open("GET",r,!0),c.setRequestHeader("x-kss-date",i),c.setRequestHeader("Authorization","KSS "+Ks3.config.AK+":"+u),c.send(null)},String.prototype.endWith=function(e){return new RegExp(e+"$").test(this)},Ks3.parseStringToXML=function(e){if(document.implementation&&document.implementation.createDocument)var t=(new DOMParser).parseFromString(e,"text/xml");else{if(!window.ActiveXObject)return alert("\u6d4f\u89c8\u5668\u4e0d\u652f\u6301xml\u89e3\u6790\uff0c\u8bf7\u5347\u7ea7\u6d4f\u89c8\u5668"),null;(t=new ActiveXObject("Microsoft.XMLDOM")).loadXML(e)}return t};